---
import { Image } from 'astro:assets';
import { getCollection } from 'astro:content';
import PageLayout from '../../layouts/PageLayout.astro';
import FormattedDate from '../../components/FormattedDate.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../../consts';

const notes = (await getCollection('notes')).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);
---

<PageLayout title={SITE_TITLE} description={SITE_DESCRIPTION}>
	<style>
		.notes-grid {
			display: grid;
			grid-template-columns: 1fr;
			gap: var(--space-8);
			list-style: none;
			margin: 0;
			padding: 0;
		}

		.notes-grid li {
			position: relative;
		}

		.notes-grid li:first-child {
			grid-column: 1 / -1;
			text-align: center;
		}

		.notes-grid li:first-child .note-card {
			background: var(--color-background-subtle);
			padding: var(--space-8);
			border-radius: var(--radius-xl);
			border: 1px solid var(--color-border);
		}

		.notes-grid li:first-child .note-image {
			width: 100%;
			max-width: 600px;
			margin: 0 auto var(--space-6);
		}

		.notes-grid li:first-child .note-title {
			font-size: var(--text-4xl);
			margin-bottom: var(--space-4);
		}

		.note-card {
			display: block;
			text-decoration: none;
			transition: all 0.2s ease;
			border-radius: var(--radius-lg);
			overflow: hidden;
			background: var(--color-background);
			border: 1px solid var(--color-border);
		}

		.note-card:hover {
			transform: translateY(-2px);
			box-shadow: var(--shadow-lg);
			text-decoration: none;
		}

		.note-image {
			width: 100%;
			height: 200px;
			object-fit: cover;
			margin-bottom: var(--space-4);
			border-radius: var(--radius-lg);
		}

		.note-content {
			padding: var(--space-4);
		}

		.note-title {
			margin: 0 0 var(--space-2) 0;
			color: var(--color-primary);
			font-size: var(--text-xl);
			font-weight: 700;
			line-height: var(--leading-tight);
			transition: color 0.2s ease;
		}

		.note-date {
			margin: 0;
			color: var(--color-muted);
			font-size: var(--text-sm);
			font-weight: 500;
			text-transform: uppercase;
			letter-spacing: 0.05em;
		}

		.note-card:hover .note-title {
			color: var(--color-accent);
		}

		@media (min-width: 768px) {
			.notes-grid {
				grid-template-columns: repeat(2, 1fr);
				gap: var(--space-8);
			}

			.notes-grid li:first-child {
				grid-column: 1 / -1;
			}
		}

		@media (min-width: 1024px) {
			.notes-grid {
				grid-template-columns: repeat(3, 1fr);
			}
		}

		@media (max-width: 768px) {
			.notes-grid {
				gap: var(--space-6);
			}

			.notes-grid li:first-child .note-card {
				padding: var(--space-6);
			}

			.notes-grid li:first-child .note-title {
				font-size: var(--text-3xl);
			}

			.note-image {
				height: 160px;
			}
		}

		@media (max-width: 480px) {
			.notes-grid li:first-child .note-title {
				font-size: var(--text-2xl);
			}

			.note-title {
				font-size: var(--text-lg);
			}
		}
	</style>
	
	<section>
		<ul class="notes-grid">
			{
				notes.map((post) => (
					<li>
						<a href={`/notes/${post.id}/`} class="note-card">
							{post.data.heroImage && (
								<Image 
									width={720} 
									height={360} 
									src={post.data.heroImage} 
									alt="" 
									class="note-image"
								/>
							)}
							<div class="note-content">
								<h4 class="note-title">{post.data.title}</h4>
								<p class="note-date">
									<FormattedDate date={post.data.pubDate} />
								</p>
							</div>
						</a>
					</li>
				))
			}
		</ul>
	</section>
</PageLayout>
